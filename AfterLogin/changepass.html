<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="keywords" content="HTML5 Template" />
    <meta name="description" content="IT Department - Login Page" />
    <meta name="author" content="potenzaglobalsolutions.com" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IT Department - Change Password</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="../images/favicon.ico" />

    <!-- Google Font -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200&display=swap"
        rel="stylesheet">

    <!-- CSS Global Compulsory (Do not remove)-->
    <link rel="stylesheet" href="../css/font-awesome/all.min.css" />
    <link rel="stylesheet" href="../css/flaticon/flaticon.css" />
    <link rel="stylesheet" href="../css/bootstrap/bootstrap.min.css" />

    <!-- Page CSS Implementing Plugins (Remove the plugin CSS here if site does not use that feature)-->

    <!-- Template Style -->
    <link rel="stylesheet" href="../css/style.css" />
</head>

<body>

    <!--=================================
    Header -->
    <header class="header header-sticky">
        <div class="topbar bg-dark py-3 d-none d-lg-flex">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="d-none d-lg-flex align-items-center text-center">
                            <div class="mr-3 d-inline-block">
                                <a class="text-white" href="mailto:gethelp@university.com"><i
                                        class="far fa-envelope mr-2"></i><span>Email:</span> info@xavier.com</a>
                            </div>
                            <div class="mr-auto d-inline-block">
                                <a class="text-white" href="mailto:gethelp@university.com"><i
                                        class="fas fa-phone-alt mr-2"></i><span>Call</span> 9876543210</a>
                            </div>
                            <div class="mr-3 d-inline-block">
                                <a class="text-white" href="mailto:gethelp@university.com"><i
                                        class="far fa-clock mr-2"></i><span>Opening:</span> 10:00am - 5:00pm</a>
                            </div>
                            <div class="social-icon">
                                <ul class="social-icon">
                                    <li>
                                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                                    </li>
                                    <li>
                                        <a href="#"><i class="fab fa-twitter"></i></a>
                                    </li>
                                    <li>
                                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                                    </li>
                                    <li>
                                        <a href="#"><i class="fab fa-instagram"></i></a>
                                    </li>
                                </ul>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!--=================================
    Header -->

    <!--=================================
    inner-header -->
    <section class="inner-banner bg-overlay-black-70 bg-holder" style="background-image: url('../images/login.jpg');">
        <div class="container">
            <div class="row d-flex justify-content-center">
                <div class="col-md-12">
                    <div class="text-center">
                        <h1 class="text-white">Change Password</h1>
                    </div>
                    <div class="d-flex justify-content-center ">
                        <ol class="breadcrumb mb-0 p-0">
                            <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
                            <li class="breadcrumb-item active"><span>Change Password</span></li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--=================================
    inner-header -->

    <!--=================================
    Login -->
    <section class="space-ptb">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xl-8 text-center">
                    <div class="section-title">
                        <h2>Change Your Password</h2>
                        <!-- <p>Sign in with XIE Email Id</p> -->
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-lg-7 mb-2">
                    <div class="login bg-white shadow p-5">
                        <div class="form-group">
                            <label>Phone/XIE Email Address</label>
                            <input type="email" class="form-control" id="exampleInputEmail1" readonly
                                placeholder="Enter email">
                            <span class="focus-border"></span>
                        </div>
                        <div class="form-group">
                            <label>Enter New Password</label>
                            <input type="password" class="form-control" id="pass" placeholder="Enter New Password">
                            <span class="focus-border"></span>
                        </div>
                        <div class="form-group">
                            <label>Confirm Password</label>
                            <input type="password" class="form-control" id="cpass" placeholder="Confirm Password">
                            <span class="focus-border"></span>
                        </div>
                        <!-- <div class="form-group custom-control custom-checkbox mr-sm-2">
                            <input type="checkbox" class="custom-control-input" id="customControlAutosizing">
                            <label class="custom-control-label" for="customControlAutosizing">Remember my
                                preference</label>
                        </div> -->
                        <button type="submit" id="btn" onclick="changePassword()" class="btn btn-primary">Change
                            Password</button>

                        <!-- <div class="login-social-media mt-4 text-center">
              <div class="d-block">
                <h5 class="mb-4 font-weight-bold">Sign in with:</h5>
                <a class="btn facebook-bg social-bg-hover mb-2 mb-sm-0" href="#"><span><i
                      class="fab fa-facebook-f pr-1"></i>Facebook</span></a>
                <a class="btn twitter-bg social-bg-hover mb-2 mb-sm-0" href="#"><span><i
                      class="fab fa-twitter pr-1"></i>Twitter</span></a>
                <a class="btn google-bg social-bg-hover mb-2 mb-sm-0" href="#"><span><i
                      class="fab fa-google pr-1"></i>Google</span></a>
              </div>
            </div> -->
                    </div>

                </div>
            </div>
        </div>
    </section>
    <!--=================================
    Login -->

    <!--=================================
    Footer-->
    <footer>
        <div class="footer-bottom bg-dark py-4">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-12 text">
                        <p class="mb-0 text-white">Â© Copyright 2024 Xavier Institute of Engineering | IT Department.<a
                                href="../index.html"></a> All
                            Rights Reserved</p>
                    </div>
                    <div class="social-icon social-icon-style-02 ml-auto">
                        <ul>
                            <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
                            <li><a href="#"><i class="fab fa-twitter"></i></a></li>
                            <li><a href="#"><i class="fab fa-linkedin-in"></i></a></li>
                            <li><a href="#"><i class="fab fa-instagram"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>


    <!--=================================
    Footer-->

    <!--=================================
    Back To Top-->
    <div id="back-to-top" class="back-to-top">up</div>
    <!--=================================
    Back To Top-->

    <!--=================================
    Javascript -->

    <!-- JS Global Compulsory (Do not remove)-->
    <script src="../js/jquery-3.5.1.min.js"></script>
    <script src="../js/popper/popper.min.js"></script>
    <script src="../js/bootstrap/bootstrap.min.js"></script>

    <!-- Page JS Implementing Plugins (Remove the plugin script here if site does not use that feature)-->
    <script src="../js/jquery.appear.js"></script>

    <!-- Template Scripts (Do not remove)-->
    <script src="../js/custom.js"></script>





    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase.js"></script>
    <script src="../config.js"></script>
    <script>
        var mail = localStorage.getItem("mail");
        var xieID = localStorage.getItem("xieID")
        console.log('xie: ' + xieID)
        console.log('mail: ' + mail)
        document.getElementById('exampleInputEmail1').value = mail;


        var pass, cpass;
        function confirmPassword() {
            var pass = document.getElementById('pass').value;
            var cpass = document.getElementById('cpass').value;
            console.log("--")
            console.log(pass, cpass);
            if (pass === cpass) {
                console.log("all good");
            } else {
                throw new Error("Something went badly wrong!");
            }

        }

        // firebase.database().ref("students/IT/TE/" + xieID).on("value", function (snap) {
        //     console.log("here is main")
        //     var demo = snap.val()
        //     console.log(demo.ID)

        // })
        var pass;
        function changePassword() {
            confirmPassword()
            pass = document.getElementById('pass').value;
            firebase.database().ref().child("students/IT/SE").orderByChild("ID").equalTo(xieID).once("value", snapshot => {
                if (snapshot.exists()) {
                    console.log("student")
                    firebase.database().ref("students/IT/SE/" + xieID).on("value", function (snap) {
                        console.log("here is main")
                        var demo = snap.val()
                        console.log(demo.ID)
                        firebase.database().ref('students/IT/SE/' + xieID).update(
                            {
                                ID: demo.ID,
                                FULLNAME: demo.FULLNAME,
                                EMAIL: demo.EMAIL,
                                CONTACT: demo.CONTACT,
                                PASSWORD: pass,
                            }
                        );

                    })
                    //edit here ok ka 

                    alert("data updated")
                } else {

                    firebase.database().ref().child("students/IT/TE").orderByChild("ID").equalTo(xieID).once("value", snapshot => {
                        if (snapshot.exists()) {
                            console.log("student")
                            console.log("student")
                            firebase.database().ref("students/IT/TE/" + xieID).on("value", function (snap) {
                                console.log("here is main" + xieID + " " + pass)
                                var demo = snap.val()
                                console.log(demo.ID)

                                firebase.database().ref('students/IT/TE/' + xieID).update(
                                    {
                                        ID: demo.ID,
                                        FULLNAME: demo.FULLNAME,
                                        EMAIL: demo.EMAIL,
                                        CONTACT: demo.CONTACT,
                                        PASSWORD: pass,
                                    }
                                );

                            })
                            alert("Data updated")
                        } else {
                            firebase.database().ref().child("students/IT/BE").orderByChild("ID").equalTo(xieID).once("value", snapshot => {
                                if (snapshot.exists()) {
                                    console.log("student")
                                    console.log("student")
                                    firebase.database().ref("students/IT/BE/" + xieID).on("value", function (snap) {
                                        console.log("here is main")
                                        var demo = snap.val()
                                        console.log(demo.ID)
                                        firebase.database().ref('students/IT/BE/' + xieID).update(
                                            {
                                                ID: demo.ID,
                                                FULLNAME: demo.FULLNAME,
                                                EMAIL: demo.EMAIL,
                                                CONTACT: demo.CONTACT,
                                                PASSWORD: pass,
                                            }
                                        );

                                    })
                                    alert("data updated")
                                } else {
                                    
                                    firebase.database().ref().child("Teachers/IT").orderByChild("ID").equalTo(xieID).once("value", snapshot => {
                                        if (snapshot.exists()) {
                                            console.log("teachers")
                                            firebase.database().ref("Teachers/IT/" + xieID).on("value", function (snap) {
                                                console.log("here is main")
                                                var demo = snap.val()
                                                console.log(demo.ID)
                                                firebase.database().ref('Teachers/IT/' + xieID).update(
                                                    {
                                                        ID: demo.ID,
                                                        FULLNAME: demo.FULLNAME,
                                                        EMAIL: demo.EMAIL,
                                                        CONTACT: demo.CONTACT,
                                                        PASSWORD: pass,
                                                    }
                                                );


                                            })
                                        }
                                        else {
                                            console.log("outsider here")
                                            firebase.database().ref().child("outerRegistrations").orderByChild("phone").equalTo(xieID).once("value", snapshot => {
                                                if (snapshot.exists()) {
                                                    firebase.database().ref("outerRegistrations/" + xieID).on("value", function (snap) {
                                                        console.log("here is main")
                                                        var demo = snap.val()
                                                        console.log(demo.phone)
                                                        var phoneV=demo.phone;
                                                        var emailV=demo.email;
                                                        var nameV=demo.name;
                                                        console.log(pass);
                                                        firebase.database().ref('outerRegistrations/' + phoneV).update(
                                                            {
                                                                name:nameV,
                                                                email:emailV,
                                                                phone:phoneV,
                                                                password: pass,
                                                            }
                                                        );


                                                    })
                                                }
                                            });

                                            alert("DAta updated");





                                        }
                                    })
                                }
                            })
                        }
                    })


                    document.getElementById('pass').value = "";
                    document.getElementById('cpass').value = "";
                }})
        }

    </script>
    <!-- <script>
        const emailIsValid = (email) => {
            return /[\S]+@(student.xavier.ac.in)/.test(email)
        }
        $('#btn').click(function (e) {
            e.preventDefault();
            // Code goes here
            InsertData(); // your onclick function call here

        });

        function InsertData() {
            var email = document.getElementById('exampleInputEmail1').value;
            console.log(email)
            var password = document.getElementById('exampleInputPassword1').value;
            console.log(password)
            fullName = "rakesh";
            contact = "23424242342"
            idV = email.slice(0, 9);
            console.log(idV)
            if (emailIsValid(email)) {
                // window.location.href = './adminlogin.html';
                console.log("valid email")

                firebase.database().ref("students/IT/TE/" + idV).on("value", function (snap) {
                    var demo = snap.val();
                    if (demo == null) {
                        alert("your details doesn't match records please contact HOD");

                    } else {
                        if (email == demo.EMAIL) {
                            if (password == demo.PASSWORD) {
                                alert("Login successful");
                                window.location.href = "../AfterLogin/index.html";
                            } else {
                                alert("Invalid details");
                            }
                        } else {
                            alert("Invalid data")
                        }

                    }

                }
                );
            } else {

                console.log("not valid");
            }

        }
    </script> 

</body>

</html>